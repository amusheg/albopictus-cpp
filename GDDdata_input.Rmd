---
title: "GDD Deadlines Japan/US 1998-2018"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

Naresh and Leslie compiled some additional climate parameters: monthly mean maximum and minimum temperatures in the US and Japan locations, 1998-2008, as well as calculating values we are calling GDD400 and GDD465: the latest days of the year on which there are 400 (or 465) growing degree days left in the year. These "deadline" values were selected based on values for temperature-dependent development rates in the literature. The climate data come from the Climate Prediction Center (CPC) and have a resolution of about 50 sq km. There are no data for Okinawa in this dataset so these will have to come from elsewhere

```{r include=FALSE}
library(tidyverse)
```


```{r}
#importing and reshaping table
gdd400_us <- read.csv("GDD400_US.csv", check.names=FALSE) %>% gather(year, gdd400, "1998":"2018", factor_key=FALSE)
gdd400_us$year<-as.numeric(gdd400_us$year)
ggplot(gdd400_us, aes(x=year, y=gdd400, color=POP)) + geom_point() + geom_line() + geom_vline(xintercept=c(2008,2018))

```
```{r}
gdd400_jp <- read.csv("GDD400_JP.csv", check.names=FALSE) %>% gather(year, gdd400, "1998":"2018", factor_key=FALSE)
gdd400_jp$year<-as.numeric(gdd400_jp$year)
ggplot(gdd400_jp, aes(x=year, y=gdd400, color=POP)) + geom_point() + geom_line() + geom_vline(xintercept=c(2008,2018))

```
```{r}
#adding latitudes
locations<-read.csv("pop_locations_2018.csv")
gdd400_us<-left_join(gdd400_us, select(locations, pop, latitude, country), by=c("POP"="pop"))
gdd400_jp<-left_join(gdd400_jp, select(locations, pop, latitude, country), by=c("POP"="pop"))
gdd400_all<-rbind(gdd400_us, gdd400_jp)
gdd400_all$POP<-as.factor(gdd400_all$POP)
gdd400_all<-mutate(gdd400_all, interval=case_when(year<=2017 & year>=2008 ~ 'y2008-2017',
                                                  year<2008 ~ 'y1998-2007'))
```

```{r}
ggplot(filter(gdd400_all, year>2014), aes(x=latitude, y=gdd400, color=country)) + geom_point() + facet_wrap(~year)
```

```{r}
ggplot(filter(gdd400_all, year<2008), aes(x=latitude, y=gdd400, color=country)) + geom_point() + facet_wrap(~year)

```
```{r}
ggplot(filter(gdd400_all, year>=2008), aes(x=latitude, y=gdd400, color=country)) + geom_point() + facet_wrap(~year)

```


```{r}
gdd400_all$interval<-as.factor(gdd400_all$interval)
```

```{r}
ggplot(filter(gdd400_all, country=="US", interval!="NA"), aes(x=interval, y=gdd400)) + geom_point(position=position_jitter()) + geom_boxplot(alpha=0) + facet_wrap(~POP)
```

```{r}
ggplot(filter(gdd400_all, country=="JP", interval!="NA"), aes(x=interval, y=gdd400)) + geom_point(position=position_jitter()) + geom_boxplot(alpha=0) + facet_wrap(~POP)

```
```{r}
```

```{r}
 ggplot(filter(gdd400_all, country=="US", interval!="NA"), aes(x=interval, y=gdd400)) + geom_point(position=position_jitter()) + geom_boxplot(alpha=0) + facet_wrap(~POP)

```
```{r}
tmin_us<-read.csv("AvgTmin_US.csv", check.names=FALSE) %>% gather(year, Tmin, "1998":"2018", factor_key=FALSE)
#In order to look at winter temperatures, need to combine Nov/Dec with Jan/Feb of the following year. January and February are reassigned in this table to the previous year to create seasonal years
tmin_us$year<-as.numeric(tmin_us$year) 
tmin_us$seasonalyear<-if_else(tmin_us$MONTH %in% c("Jan","Feb"), tmin_us$year-1, tmin_us$year)
minwintertemp_us<-filter(tmin_us, MONTH %in% c("Nov","Dec","Jan","Feb")) %>% group_by(POP, seasonalyear) %>% summarise(wintermin=min(Tmin)) %>% filter(seasonalyear!=1997)
ggplot(minwintertemp_us, aes(x=seasonalyear, y=wintermin, color=POP)) + geom_point() + geom_line() + geom_vline(xintercept=c(2008,2018)) 
```
```{r}
tmin_jp<-read.csv("AvgTmin_JP.csv", check.names=FALSE) %>% gather(year, Tmin, "1998":"2018", factor_key=FALSE)
tmin_jp$year<-as.numeric(tmin_jp$year) 
tmin_jp$seasonalyear<-if_else(tmin_jp$MONTH %in% c("Jan","Feb"), tmin_jp$year-1, tmin_jp$year)
minwintertemp_jp<-filter(tmin_jp, MONTH %in% c("Nov","Dec","Jan","Feb")) %>% group_by(POP, seasonalyear) %>% summarise(wintermin=min(Tmin)) %>% filter(seasonalyear!=1997)
ggplot(minwintertemp_jp, aes(x=seasonalyear, y=wintermin, color=POP)) + geom_point() + geom_line() + geom_vline(xintercept=c(2008,2018))
```

```{r}
wintermin_all<-rbind(minwintertemp_us, minwintertemp_jp)
#gdd400_us<-left_join(gdd400_us, select(locations, pop, latitude, country), by=c("POP"="pop"))
#gdd400_jp<-left_join(gdd400_jp, select(locations, pop, latitude, country), by=c("POP"="pop"))
#gdd400_all<-rbind(gdd400_us, gdd400_jp)
#gdd400_all$POP<-as.factor(gdd400_all$POP)
#gdd400_all<-mutate(gdd400_all, interval=case_when(year<=2017 & year>=2008 ~ 'y2008-2017',
#                                                  year<2008 ~ 'y1998-2007'))
gdd400_all_new<-left_join(gdd400_all, wintermin_all, by=c("POP"="POP", "year"="seasonalyear"))
gdd400_all_new$POP<-as.factor(gdd400_all_new$POP)
```

```{r}
ggplot(filter(gdd400_all_new, interval=="y1998-2007"), aes(x=latitude, y=wintermin, color=country)) + geom_point() + facet_wrap(~year) 
```

```{r}
ggplot(filter(gdd400_all_new, interval=="y2008-2017"), aes(x=latitude, y=wintermin, color=country)) + geom_point() + facet_wrap(~year)

```

```{r}
ggplot(filter(gdd400_all_new, interval=="y1998-2007"), aes(x=wintermin, y=gdd400, color=country)) + geom_point() + facet_wrap(~year)
#Generally: at any given winter coldness, Japan has an earlier deadline than US
```
```{r}
ggplot(filter(gdd400_all_new, interval=="y2008-2017"), aes(x=wintermin, y=gdd400, color=country)) + geom_point() + facet_wrap(~year)
#Generally: at any given winter coldness, Japan has an earlier deadline than US

```

